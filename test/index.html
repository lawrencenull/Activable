<!DOCTYPE HTML>
<html>
<head>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />
  <script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
  <script src="../activable.js"></script>

  <script>
  $(document).ready(function(){

module("standard features");

test("data-activable=0X", function() {
  var $target;

  $target = $("#test1>li:eq(0)").click();
  ok( $target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` once clicked" );

  $target = $("#test1>li:eq(1)").Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once clicked" );

  $target = $("#test1>li:eq(2)");
  $("#test1_item3").Click();
  ok( $target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` once one of its children is clicked" );

  $target = $("#test1>li:eq(3)");
  $("#test1_item4").Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once one of its children is clicked" );
});

test("data-activable=T", function() {
  var $target, $previous;

  $target = $("#test2b>li:eq(0)").Click();
  ok( $target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` once clicked" );

  $previous = $target;
  $target = $("#test2b>li:eq(1)").Click();
  ok( $target.hasClass( "active" ), "another element that wasn't `.active` becomes `.active` once clicked..." );
  ok( !$previous.hasClass( "active" ), "... and the previously `.active` element is no more `.active`" );

  $previous = $target;
  $target = $("#test2b>li:eq(2)");
  $("#test2b_item3").Click();
  ok( $target.hasClass( "active" ), "another element that wasn't `.active` becomes `.active` once one of its children is clicked..." );
  ok( !$previous.hasClass( "active" ), "... and the previously `.active` element is no more `.active`" );

  $target.Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once clicked" );

  $target.Click();
  $(document.body).Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once a non-activable element is clicked" );

  $target.Click();
  $("#test1>li:eq(2)").Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once a different activable element is clicked" );
});

module("activable list");

test("data-activable", function() {
  var $target, $previous;

  $target = $("#test3d>li:eq(0)").Click();
  ok( $target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` once clicked" );

  $previous = $target;
  $target = $("#test3d>li:eq(1)").Click();
  ok( $target.hasClass( "active" ), "another element that wasn't `.active` becomes `.active` once clicked..." );
  ok( !$previous.hasClass( "active" ), "... and the previously `.active` element is no more `.active`" );

  $target.Click();
  ok( $target.hasClass( "active" ), "an element that was `.active` is still `.active` once clicked" );

  $previous = $target;
  $target = $("#test3d>li:eq(2)");
  $("#test3d_item3").Click();
  ok( $target.hasClass( "active" ), "another element that wasn't `.active` becomes `.active` once one of its children is clicked..." );
  ok( !$previous.hasClass( "active" ), "... and the previously `.active` element is no more `.active`" );
});

test("data-activable=01", function() {
  var $target, $previous;

  $target = $("#test2d>li:eq(0)").Click();
  ok( $target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` once clicked" );

  $previous = $target;
  $target = $("#test2d>li:eq(1)").Click();
  ok( $target.hasClass( "active" ), "another element that wasn't `.active` becomes `.active` once clicked..." );
  ok( !$previous.hasClass( "active" ), "... and the previously `.active` element is no more `.active`" );

  $previous = $target;
  $target = $("#test2d>li:eq(2)");
  $("#test2d_item3").Click();
  ok( $target.hasClass( "active" ), "another element that wasn't `.active` becomes `.active` once one of its children is clicked..." );
  ok( !$previous.hasClass( "active" ), "... and the previously `.active` element is no more `.active`" );

  $target.Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once clicked" );
});

test("data-activable=T", function() {
  var $target, $previous;

  $target = $("#test2db>li:eq(0)").Click();
  ok( $target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` once clicked" );

  $previous = $target;
  $target = $("#test2db>li:eq(1)").Click();
  ok( $target.hasClass( "active" ), "another element that wasn't `.active` becomes `.active` once clicked..." );
  ok( !$previous.hasClass( "active" ), "... and the previously `.active` element is no more `.active`" );

  $previous = $target;
  $target = $("#test2db>li:eq(2)");
  $("#test2db_item3").Click();
  ok( $target.hasClass( "active" ), "another element that wasn't `.active` becomes `.active` once one of its children is clicked..." );
  ok( !$previous.hasClass( "active" ), "... and the previously `.active` element is no more `.active`" );

  $target.Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once clicked" );

  $target.Click();
  $(document.body).Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once a non-activable element is clicked" );

  $target.Click();
  $("#test1d>li:eq(2)").Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once a different activable element is clicked" );
});

test("data-activable=0X", function() {
  var $target;

  $target = $("#test1d>li:eq(0)").click();
  ok( $target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` once clicked" );

  $target = $("#test1d>li:eq(1)").Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once clicked" );

  $target = $("#test1d>li:eq(2)");
  $("#test1d_item3").Click();
  ok( $target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` once one of its children is clicked" );

  $target = $("#test1d>li:eq(3)");
  $("#test1d_item4").Click();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` once one of its children is clicked" );
});

module("Delegate")

test("data-delegate=''", function() {
  var $target;

  $target = $("#test11>li:eq(0)").click();
  ok( !$target.hasClass( "active" ), "a clicked list-item doesn't become active" );
  ok( $target.parent().hasClass( "active" ), "the list itself becomes active" );

  $target = $("#test11>li:eq(1)").click();
  ok( !$target.hasClass( "active" ), "a clicked list-item doesn't become active" );
  ok( !$target.parent().hasClass( "active" ), "the active list itself becomes inactive again" );
});

test("data-delegate='<selector>'", function() {
  var $target, $previous;

  $target = $("#test12>.cell:eq(0)").Click();
  ok( $target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` once clicked" );

  $previous = $target;
  $target = $("#test12>.cell:eq(1)").Click();
  ok( $target.hasClass( "active" ), "another element that wasn't `.active` becomes `.active` once clicked..." );
  ok( !$previous.hasClass( "active" ), "... and the previously `.active` element is no more `.active`" );

  $target.Click();
  ok( $target.hasClass( "active" ), "an element that was `.active` is still `.active` once clicked" );

  $previous = $target;
  $target = $("#test12>.cell:eq(2)");
  $("#test12_item3").Click();
  ok( $target.hasClass( "active" ), "another element that wasn't `.active` becomes `.active` once one of its children is clicked..." );
  ok( !$previous.hasClass( "active" ), "... and the previously `.active` element is no more `.active`" );
});

module( "Trigger" );

test("data-trigger='>:first-child'", function() {
  var $target;

  $target = $("#test4>li:eq(0)");
  $("#test4_item1").Click();
  ok( $target.hasClass( "active" ), "clicking on the trigger works" );

  $target = $("#test4>li:eq(1)").Click();
  ok( !$target.hasClass( "active" ), "clicking directly on the activable doesn't work" );

  $("#test4_span2").Click();
  ok( !$target.hasClass( "active" ), "clicking outside the trigger doesn't work" );

  $target = $("#test4>li:eq(2)");
  $("#test4_item3").Click();
  ok( $target.hasClass( "active" ), "The anchor can only be a firstElementChild" );

  $target = $("#test4>li:eq(3)");
  $("#test4_item4").Click();
  ok( $target.hasClass( "active" ), "Clicking in trigger descendants works" );

  $target = $("#test4>li:eq(4)");
  $("#test4_item5").Click();
  ok( !$target.hasClass( "active" ), "Clicking in trigger when the activable is already active works" );
});

module( "internal target" );

test("toggle active on internal target", function() {
  var $itarget;

  $("#test5_item1").Click();
  $itarget = $("#exists");
  ok( $itarget.hasClass( "active" ), "click on trigger makes the internal target active" );

  ok( $("#test5_item2").Click(), "click on trigger with inexistant internal target doesn't throw" );

  $("#test5_item3").Click();
  $itarget = $("#inactive");
  ok( !$itarget.hasClass( "active" ), "the state of the internal target is dependant of the state of the activable" );

  $("#test5_anchor").Click();
  $itarget = $("#test5_span");
  ok( $itarget.hasClass( "active" ), "a lonely activable target can have an internal target" );

});

module("JS API - Basic Methods");

test("Activable()/A()", function() {
  equal( Activable, A, "Activable and A are equal" );

  var $target = $("#test1");
  equal( A( document.getElementById("test1") )[0], $target[0], "passing a DOM element to A()" );

  equal( A( "#test1" )[0], $target[0], "passing a selector string to A()" );
});

module( "JS API - Direct Modifiers" );

test("A.activate()/A.deactivate()/A.toggle()", function() {
  var $target;

  A( ( $target = $("#test6>li:eq(0)") )[0] ).activate();
  ok( $target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` with .activate()" );

  A( ( $target = $("#test6>li:eq(1)") )[0] ).deactivate();
  ok( !$target.hasClass( "active" ), "an element that was `.active` is no more `.active` with .deactivate()" );

  A( ( $target = $("#test6>li:eq(0)") )[0] ).activate();
  ok( $target.hasClass( "active" ), "an element that was `.active` is no more `.active` with .toggle()" );

  A( ( $target = $("#test6>li:eq(1)") )[0] ).deactivate();
  ok( !$target.hasClass( "active" ), "an element that wasn't `.active` becomes `.active` with .toggle()" );
});

test("A.activate()/A.deactivate()/A.toggle() and tab behavior", function() {
  var $target;

  A( ( $target = $("#test7>li:eq(0)") )[0] ).activate();
  ok( $target.hasClass( "active" ) && !$("#test7>li:eq(1)").hasClass("active"), "switch the active element" );

  A( ( $target = $("#test7>li:eq(1)") )[0] ).toggle();
  ok( $target.hasClass( "active" ) && !$("#test7>li:eq(0)").hasClass("active"), "switch the active element with toggle");
});

module("JS API - Iterative Modifiers");

test(".next( false ) / .prev( false ) / .activate( index, false )", function() {

  A("#test9").next();
  equal( A("#test9 .active")[0].id, "test9_item2", ".next() makes next item active" );

  A("#test9").prev();
  equal( A("#test9 .active")[0].id, "test9_item1", ".prev() makes previous item active" );

  A("#test9").prev();
  equal( A("#test9 .active")[0].id, "test9_item1", ".prev() doesn't have any effect when first element is active" );

  A("#test9").activate( 2 );
  equal( A("#test9 .active")[0].id, "test9_item3", ".activate( index ) activate the element at the given index" );

  A("#test9").next();
  equal( A("#test9 .active")[0].id, "test9_item3", ".next() doesn't have any effect when last element is active" );
});

test(".next( true ) / .prev( true ) / .activate( index, true )", function() {

  A("#test10").prev( true );
  equal( A("#test10 .active")[0].id, "test10_item3", ".prev( true ) is able to loop" );

  A("#test10").next( true );
  equal( A("#test10 .active")[0].id, "test10_item1", ".next( true ) is able to loop" );

});

/*module( "JS API - Event Listeners" );

test("event listening", function() {
  expect(0);

  A( $("#test8>li:eq(0)")[0] ).on("activate", function(){  });
  $("#test8>li:eq(0)").Click();
});*/

module("miscellaneous");

test("clicks on `<body>` and `<html>` don't throw", function() {
  ok( $( document.body ).Click(), "body didn't throw" );
  // for some reasons it never throws in Firefox
  ok( $( document.documentElement ).Click(), "html didn't throw" );
});

/*test("prevent default", function() {

  $("#test5_anchor").Click();
  equal( window.location.hash, "", "window.location.hash is empty" );
});*/

/* TOTEST;
 * - preventDefault
 * - nested activable
 * - Event API
 */


  });

function fireClick(obj,evt){

    var fireOnThis = obj;
    evt = "click";

    if( document.createEvent ) {
      var evObj = document.createEvent('MouseEvents');
      evObj.initEvent( evt, true, false );
      fireOnThis.dispatchEvent( evObj );

    } else if( document.createEventObject ) {
      var evObj = document.createEventObject();
      fireOnThis.fireEvent( 'on' + evt, evObj );
    }
}

jQuery.fn.Click = function() { return this.each(function(i,el) { fireClick(el); }); };
  </script>
  
</head>
<body>
  <h1 id="qunit-header">QUnit example</h1>
 <h2 id="qunit-banner"></h2>
 <div id="qunit-testrunner-toolbar"></div>
 <h2 id="qunit-userAgent"></h2>
 <ol id="qunit-tests"></ol>
 <div id="qunit-fixture">
 	
 	<ul id="test1">
 		<li data-activable=0X>item1</li>
 		<li data-activable=0X class="active">item2</li>
		<li data-activable=0X><span><span><span id="test1_item3">item3</span></span></span></li>
 		<li data-activable=0X class="active"><span><span><span id="test1_item4">item4</span></span></span></li>
	</ul>

  <ul id="test2b">
    <li data-activable=T>item1</li>
    <li data-activable=T>item2</li>
    <li data-activable=T><span><span><span id="test2b_item3">item3</span></span></span></li>
  </ul>

	<ul id="test4" data-activable=0X data-trigger=">:first-child">
    <li><!-- comment1 --><!-- comment2 --><a id="test4_item1">item1</a></li>
    <li><a>item2</a><span id="test4_span2">outside</span></li>
    <li><span><a id="test4_item3">item3</a></span></li>
    <li><a><span><span><span id="test4_item4">item4</span></span></span></a></li>
    <li class="active"><!-- comment --><a id="test4_item5">item5</a></li>
  </ul>

  <ul id="test5" data-activable=0X data-trigger=">:first-child">
    <li><!-- comment1 --><!-- comment2 --><a id="test5_item1" href="#exists">item1</a></li>
    <li><a id="test5_item2" href="#doesntexist">item2</a></li>
    <li class="active"><a id="test5_item3" href="#inactive">item3</a></li>
  </ul>

  <div id="exists"></div>
  <div id="inactive"></div>

  <p><a id="test5_anchor" data-activable=0X href="#test5_span"></a><span id="test5_span"></p>

  <ul id="test6">
    <li data-activable=0X>item1</li>
    <li data-activable=0X class="active">item2</li>
  </ul>

   <ul id="test7" data-activable>
    <li>item1</li>
    <li class="active">item2</li>
  </ul>

  <ul id="test8">
    <li data-activable=0X>item1</li>
    <li data-activable=0X class="active">item2</li>
  </ul>

  <ul id="test1d" data-activable=0X>
    <li>item1</li>
    <li class="active">item2</li>
    <li><span><span><span id="test1d_item3">item3</span></span></span></li>
    <li class="active"><span><span><span id="test1d_item4">item4</span></span></span></li>
  </ul>

  <ul id="test3d" data-activable>
    <li>item1</li>
    <li>item2</li>
    <li><span><span><span id="test3d_item3">item3</span></span></span></li>
  </ul>

  <ul id="test2d" data-activable=01>
    <li>item1</li>
    <li>item2</li>
    <li><span><span><span id="test2d_item3">item3</span></span></span></li>
  </ul>

  <ul id="test2db" data-activable=T>
    <li>item1</li>
    <li>item2</li>
    <li><span><span><span id="test2db_item3">item3</span></span></span></li>
  </ul>

  <ul id="test9" data-activable>
    <li id="test9_item1" class="active">item1
    <li id="test9_item2">item2
    <li id="test9_item3">item3
  </ul>

  <ul id="test10" data-activable>
    <li id="test10_item1" class="active">item1
    <li id="test10_item2">item2
    <li id="test10_item3">item3
  </ul>

  <ul id="test11" data-activable=0X data-delegate="">
    <li>item1</li>
    <li>item2</li>
  </ul>

  <div class="row" id="test12" data-activable data-delegate=".cell">
    <div class="cell">item1</div>
    <div class="cell">item2</div>
    <div class="cell"><span><span><span id="test12_item3">item3</span></span></span></div>
  </div>

 </div>
</body>
</html>